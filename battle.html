<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ°é¬¥å‚·å®³è¨ˆç®—å™¨ - ç°¡åŒ–ç‰ˆ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card-gradient {
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
        }
        .loading-spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- è¼‰å…¥æŒ‡ç¤ºå™¨ -->
    <div id="loading" class="fixed inset-0 flex items-center justify-center z-50">
        <div class="card-gradient rounded-lg p-8 text-center text-white max-w-md mx-4">
            <div class="loading-spinner mx-auto mb-4"></div>
            <h2 class="text-xl font-bold mb-2">è¼‰å…¥æˆ°é¬¥è¨ˆç®—å™¨</h2>
            <p id="loadingStatus" class="text-sm opacity-80">æ­£åœ¨åˆå§‹åŒ–...</p>
            <div id="errorMessage" class="mt-4 p-3 bg-red-500 bg-opacity-20 rounded text-red-200 text-sm hidden"></div>
        </div>
    </div>

    <!-- ä¸»æ‡‰ç”¨ -->
    <div id="app" class="hidden min-h-screen p-4">
        <div class="max-w-6xl mx-auto">
            <!-- æ¨™é¡Œ -->
            <div class="card-gradient rounded-lg p-6 mb-6 text-white text-center">
                <h1 class="text-3xl font-bold mb-2">âš”ï¸ æˆ°é¬¥å‚·å®³è¨ˆç®—å™¨</h1>
                <p class="opacity-80">ç°¡åŒ–ç‰ˆ - å¿«é€Ÿè¨ˆç®—å‚·å®³</p>
            </div>

            <!-- é…ç½®é¢æ¿ */
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
                <!-- æ­æª”é¸æ“‡ -->
                <div class="card-gradient rounded-lg p-6 text-white">
                    <h3 class="text-lg font-bold mb-4">ğŸ‘¥ æ­æª”é…ç½®</h3>
                    <div class="space-y-4">
                        <select id="partnerSelect" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50">
                            <option value="" class="text-gray-800">é¸æ“‡æ­æª”</option>
                        </select>
                        <select id="professionSelect" class="w-full p-3 rounded-lg bg-white bg-opacity-20 text-white border border-white border-opacity-30 focus:outline-none focus:ring-2 focus:ring-white focus:ring-opacity-50">
                            <option value="" class="text-gray-800">é¸æ“‡è·æ¥­</option>
                        </select>
                    </div>
                </div>

                <!-- å¿«é€Ÿé…ç½® -->
                <div class="card-gradient rounded-lg p-6 text-white">
                    <h3 class="text-lg font-bold mb-4">âš™ï¸ å¿«é€Ÿé…ç½®</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm mb-2">ç‰½çµ†ç­‰ç´š: <span id="bondValue" class="font-bold">25</span></label>
                            <input type="range" id="bondSlider" min="1" max="220" value="25" class="w-full">
                        </div>
                        <div>
                            <label class="block text-sm mb-2">æ˜Ÿè­œåŒ¹é…: <span id="constValue" class="font-bold">0</span></label>
                            <input type="range" id="constSlider" min="0" max="6" value="0" class="w-full">
                        </div>
                        <button id="quickSetup" class="w-full py-2 px-4 bg-white bg-opacity-20 rounded-lg hover:bg-opacity-30 transition-all">
                            ğŸš€ ä¸€éµæ»¿é…
                        </button>
                    </div>
                </div>

                <!-- å¡ç‰‡é¸æ“‡ -->
                <div class="card-gradient rounded-lg p-6 text-white">
                    <h3 class="text-lg font-bold mb-4">ğŸƒ å¡ç‰‡é¸æ“‡</h3>
                    <div class="space-y-2 max-h-48 overflow-y-auto">
                        <!-- å¡ç‰‡æœƒå‹•æ…‹ç”Ÿæˆ -->
                    </div>
                </div>
            </div>

            <!-- çµæœé¡¯ç¤º -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- å±¬æ€§é¢æ¿ -->
                <div class="card-gradient rounded-lg p-6 text-white">
                    <h3 class="text-lg font-bold mb-4">ğŸ“Š éšŠä¼å±¬æ€§</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold" id="hpDisplay">0</div>
                            <div class="text-sm opacity-80">â¤ï¸ ç”Ÿå‘½</div>
                        </div>
                        <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold" id="atkDisplay">0</div>
                            <div class="text-sm opacity-80">âš”ï¸ æ”»æ“Š</div>
                        </div>
                        <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold" id="defDisplay">0</div>
                            <div class="text-sm opacity-80">ğŸ›¡ï¸ é˜²ç¦¦</div>
                        </div>
                        <div class="bg-white bg-opacity-10 rounded-lg p-4 text-center">
                            <div class="text-2xl font-bold" id="critDisplay">0%</div>
                            <div class="text-sm opacity-80">âš¡ æš´æ“Š</div>
                        </div>
                    </div>
                </div>

                <!-- å‚·å®³é¢æ¿ -->
                <div class="card-gradient rounded-lg p-6 text-white">
                    <h3 class="text-lg font-bold mb-4">ğŸ’¥ æŠ€èƒ½å‚·å®³</h3>
                    <div class="space-y-3">
                        <div class="bg-white bg-opacity-10 rounded-lg p-3">
                            <div class="flex justify-between items-center">
                                <span class="font-medium">ğŸ‘Š æ™®æ”»</span>
                                <div class="text-right">
                                    <div class="text-sm">ä¸€èˆ¬: <span id="basicNormal">0</span></div>
                                    <div class="text-sm text-yellow-300">æš´æ“Š: <span id="basicCrit">0</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white bg-opacity-10 rounded-lg p-3">
                            <div class="flex justify-between items-center">
                                <span class="font-medium">âš¡ ä¸»å‹•æŠ€</span>
                                <div class="text-right">
                                    <div class="text-sm">ä¸€èˆ¬: <span id="skill1Normal">0</span></div>
                                    <div class="text-sm text-yellow-300">æš´æ“Š: <span id="skill1Crit">0</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white bg-opacity-10 rounded-lg p-3">
                            <div class="flex justify-between items-center">
                                <span class="font-medium">ğŸŒŸ å…±é³´æŠ€</span>
                                <div class="text-right">
                                    <div class="text-sm">ä¸€èˆ¬: <span id="skill2Normal">0</span></div>
                                    <div class="text-sm text-yellow-300">æš´æ“Š: <span id="skill2Crit">0</span></div>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white bg-opacity-10 rounded-lg p-3">
                            <div class="flex justify-between items-center">
                                <span class="font-medium">ğŸ’« èª“ç´„æŠ€</span>
                                <div class="text-right">
                                    <div class="text-sm">ä¸€èˆ¬: <span id="ultimateNormal">0</span></div>
                                    <div class="text-sm text-yellow-300">æš´æ“Š: <span id="ultimateCrit">0</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç‹€æ…‹ä¿¡æ¯ -->
            <div class="card-gradient rounded-lg p-4 mt-6 text-white text-center">
                <p id="statusInfo" class="text-sm opacity-80">é¸æ“‡æ­æª”é–‹å§‹è¨ˆç®—</p>
            </div>
        </div>
    </div>

    <!-- å…§åµŒç°¡åŒ–æ•¸æ“š -->
    <script>
        // ç°¡åŒ–çš„éŠæˆ²æ•¸æ“š
        const gameData = {
            partners: [
                { id: 'lishen', name: 'é»æ·±' },
                { id: 'qinche', name: 'ç§¦å¾¹' },
                { id: 'shenxinghui', name: 'æ²ˆæ˜Ÿå›' },
                { id: 'xiayizhou', name: 'å¤ä»¥æ™' },
                { id: 'qiyu', name: 'ç¥ç…œ' }
            ],
            professions: {
                'lishen': [
                    { id: 'eternal_prophet', name: 'æ°¸æ†å…ˆçŸ¥' },
                    { id: 'jiuli_commander', name: 'ä¹é»å¸å‘½' }
                ],
                'qinche': [
                    { id: 'endless_raider', name: 'ç„¡ç›¡æ å¥ªè€…' },
                    { id: 'abyss_master', name: 'æ·±æ·µä¸»å®°' }
                ],
                'shenxinghui': [
                    { id: 'light_chaser', name: 'é€å…‰é¨å£«' },
                    { id: 'light_hunter', name: 'å…‰çµ' }
                ],
                'xiayizhou': [
                    { id: 'fleet_officer', name: 'é ç©ºåŸ·è‰¦å®˜' },
                    { id: 'weapon_x02', name: 'çµ‚æ¥µå…µå™¨X-02' }
                ],
                'qiyu': [
                    { id: 'deep_sea_diver', name: 'æ·±æµ·æ½›è¡Œè€…' },
                    { id: 'tidal_god', name: 'æ½®æ±ä¹‹ç¥' }
                ]
            },
            cards: {
                'lishen': [
                    { name: 'æ°¸æ†å°å¡µ', category: 'æ—¥å¡', type: 'defense' },
                    { name: 'æ°¸æ†å¿ƒå½¹', category: 'æ—¥å¡', type: 'defense' },
                    { name: 'æ“é›ªè¦‹ç·£', category: 'æ—¥å¡', type: 'attack' },
                    { name: 'æ“é›ªæœªçœ ', category: 'æ—¥å¡', type: 'attack' },
                    { name: 'å¤±åº', category: 'æœˆå¡', type: 'defense' },
                    { name: 'æŠµæ­¤å¿ƒä¸Š', category: 'æœˆå¡', type: 'attack' }
                ],
                'qinche': [
                    { name: 'æ å¿ƒç›¸æˆ', category: 'æ—¥å¡', type: 'attack' },
                    { name: 'æ å¿ƒå¥ªå‘³', category: 'æ—¥å¡', type: 'attack' },
                    { name: 'æ·±æ·µéœæšˆ', category: 'æ—¥å¡', type: 'life' },
                    { name: 'æ·±æ·µç§˜å°', category: 'æ—¥å¡', type: 'life' }
                ],
                'shenxinghui': [
                    { name: 'é€å…‰ç ´å½±', category: 'æ—¥å¡', type: 'attack' },
                    { name: 'é€å…‰è¿·å¿ƒ', category: 'æ—¥å¡', type: 'attack' },
                    { name: 'æœ«å¤œå¿ƒè²', category: 'æ—¥å¡', type: 'defense' },
                    { name: 'æœ«å¤œé›¨æ„', category: 'æ—¥å¡', type: 'defense' }
                ],
                'xiayizhou': [
                    { name: 'é ç©ºè¿·èˆª', category: 'æ—¥å¡', type: 'defense' },
                    { name: 'é ç©ºæ£ é›¨', category: 'æ—¥å¡', type: 'defense' },
                    { name: 'å¯‚è·¯åŒèµ´', category: 'æ—¥å¡', type: 'attack' },
                    { name: 'å¯‚è·¯ä¸æ­¸', category: 'æ—¥å¡', type: 'attack' }
                ],
                'qiyu': [
                    { name: 'æ·±æµ·æˆè«¾', category: 'æ—¥å¡', type: 'attack' },
                    { name: 'æ·±æµ·æ·¬é‡‘', category: 'æ—¥å¡', type: 'attack' },
                    { name: 'ç¥æ®¿æ—¥è½', category: 'æ—¥å¡', type: 'life' },
                    { name: 'ç¥æ®¿ç§˜ç´„', category: 'æ—¥å¡', type: 'life' }
                ]
            },
            skillMultipliers: {
                'eternal_prophet': { basic: 0.8, skill1: 2.2, skill2: 3.8, ultimate: 5.5 },
                'jiuli_commander': { basic: 1.0, skill1: 2.5, skill2: 4.2, ultimate: 6.0 },
                'endless_raider': { basic: 0.9, skill1: 2.3, skill2: 4.0, ultimate: 5.8 },
                'abyss_master': { basic: 0.7, skill1: 2.0, skill2: 3.5, ultimate: 5.2 },
                'light_chaser': { basic: 1.1, skill1: 2.4, skill2: 4.1, ultimate: 6.2 },
                'light_hunter': { basic: 0.8, skill1: 2.1, skill2: 3.7, ultimate: 5.4 },
                'fleet_officer': { basic: 0.9, skill1: 2.2, skill2: 3.9, ultimate: 5.6 },
                'weapon_x02': { basic: 1.0, skill1: 2.6, skill2: 4.3, ultimate: 6.1 },
                'deep_sea_diver': { basic: 0.95, skill1: 2.4, skill2: 4.0, ultimate: 5.9 },
                'tidal_god': { basic: 0.85, skill1: 2.1, skill2: 3.6, ultimate: 5.3 }
            }
        };

        // æ‡‰ç”¨ç‹€æ…‹
        let selectedPartner = '';
        let selectedProfession = '';
        let selectedCards = [];
        let bondLevel = 25;
        let constellationLevel = 0;

        // æ›´æ–°ç‹€æ…‹
        function updateStatus(message) {
            const statusEl = document.getElementById('loadingStatus');
            const statusInfo = document.getElementById('statusInfo');
            if (statusEl) statusEl.textContent = message;
            if (statusInfo) statusInfo.textContent = message;
            console.log('ğŸ“', message);
        }

        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.classList.remove('hidden');
            }
            console.error('âŒ', message);
        }

        // åˆå§‹åŒ–æ‡‰ç”¨
        function initApp() {
            try {
                updateStatus('è¼‰å…¥æ­æª”æ•¸æ“š...');
                
                // è¼‰å…¥æ­æª”é¸é …
                const partnerSelect = document.getElementById('partnerSelect');
                gameData.partners.forEach(partner => {
                    const option = document.createElement('option');
                    option.value = partner.id;
                    option.textContent = partner.name;
                    option.className = 'text-gray-800';
                    partnerSelect.appendChild(option);
                });

                // ç¶å®šäº‹ä»¶
                partnerSelect.addEventListener('change', handlePartnerChange);
                document.getElementById('professionSelect').addEventListener('change', handleProfessionChange);
                document.getElementById('bondSlider').addEventListener('input', handleBondChange);
                document.getElementById('constSlider').addEventListener('input', handleConstChange);
                document.getElementById('quickSetup').addEventListener('click', quickSetup);

                updateStatus('åˆå§‹åŒ–å®Œæˆï¼');
                
                // é¡¯ç¤ºæ‡‰ç”¨
                setTimeout(() => {
                    document.getElementById('loading').classList.add('hidden');
                    document.getElementById('app').classList.remove('hidden');
                    updateStatus('é¸æ“‡æ­æª”é–‹å§‹è¨ˆç®—');
                }, 500);

            } catch (error) {
                showError(`åˆå§‹åŒ–å¤±æ•—: ${error.message}`);
            }
        }

        // äº‹ä»¶è™•ç†
        function handlePartnerChange(e) {
            selectedPartner = e.target.value;
            updateProfessions();
            updateCards();
            updateStatus(selectedPartner ? `å·²é¸æ“‡æ­æª”: ${gameData.partners.find(p => p.id === selectedPartner)?.name}` : 'é¸æ“‡æ­æª”é–‹å§‹è¨ˆç®—');
        }

        function handleProfessionChange(e) {
            selectedProfession = e.target.value;
            calculate();
            updateStatus(selectedProfession ? 'è·æ¥­å·²é¸æ“‡ï¼Œè¨ˆç®—å‚·å®³ä¸­...' : 'è«‹é¸æ“‡è·æ¥­');
        }

        function handleBondChange(e) {
            bondLevel = parseInt(e.target.value);
            document.getElementById('bondValue').textContent = bondLevel;
            calculate();
        }

        function handleConstChange(e) {
            constellationLevel = parseInt(e.target.value);
            document.getElementById('constValue').textContent = constellationLevel;
            calculate();
        }

        function quickSetup() {
            document.getElementById('bondSlider').value = 220;
            document.getElementById('constSlider').value = 6;
            bondLevel = 220;
            constellationLevel = 6;
            document.getElementById('bondValue').textContent = '220';
            document.getElementById('constValue').textContent = '6';
            
            // å…¨é¸å¡ç‰‡
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
            updateSelectedCards();
            calculate();
            updateStatus('å·²è¨­ç½®ç‚ºæ»¿é…ï¼');
        }

        function updateProfessions() {
            const professionSelect = document.getElementById('professionSelect');
            professionSelect.innerHTML = '<option value="" class="text-gray-800">é¸æ“‡è·æ¥­</option>';
            
            if (selectedPartner && gameData.professions[selectedPartner]) {
                gameData.professions[selectedPartner].forEach(profession => {
                    const option = document.createElement('option');
                    option.value = profession.id;
                    option.textContent = profession.name;
                    option.className = 'text-gray-800';
                    professionSelect.appendChild(option);
                });
            }
        }

        function updateCards() {
            const cardContainer = document.querySelector('.card-gradient .space-y-2');
            cardContainer.innerHTML = '';
            
            if (selectedPartner && gameData.cards[selectedPartner]) {
                gameData.cards[selectedPartner].forEach((card, index) => {
                    const cardElement = document.createElement('label');
                    cardElement.className = 'flex items-center space-x-2 cursor-pointer hover:bg-white hover:bg-opacity-10 rounded p-2';
                    cardElement.innerHTML = `
                        <input type="checkbox" class="text-blue-500" onchange="updateSelectedCards()">
                        <span class="text-sm">${card.name}</span>
                        <span class="text-xs opacity-60">(${card.category})</span>
                    `;
                    cardContainer.appendChild(cardElement);
                });
            }
        }

        function updateSelectedCards() {
            selectedCards = [];
            const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
            checkboxes.forEach(cb => {
                const cardName = cb.parentElement.querySelector('span').textContent;
                selectedCards.push(cardName);
            });
            calculate();
        }

        // ç°¡åŒ–è¨ˆç®—
        function calculate() {
            if (!selectedPartner || !selectedProfession || selectedCards.length === 0) {
                resetDisplay();
                return;
            }

            try {
                // ç°¡åŒ–çš„å±¬æ€§è¨ˆç®—
                const baseAtk = 200 + (selectedCards.length * 150); // åŸºç¤æ”»æ“Š
                const bondBonus = Math.floor(bondLevel / 5) * 10; // ç‰½çµ†åŠ æˆ
                const constBonus = constellationLevel * 50; // æ˜Ÿè­œåŠ æˆ
                
                const totalAtk = baseAtk + bondBonus + constBonus;
                const totalHp = totalAtk * 8; // ç”Ÿå‘½æ˜¯æ”»æ“Šçš„8å€
                const totalDef = totalAtk * 0.6; // é˜²ç¦¦æ˜¯æ”»æ“Šçš„0.6å€
                const critRate = 15 + constellationLevel * 2; // åŸºç¤æš´æ“Šç‡
                const critDamage = 150 + constellationLevel * 10; // åŸºç¤æš´æ“Šå‚·å®³

                // æ›´æ–°å±¬æ€§é¡¯ç¤º
                document.getElementById('hpDisplay').textContent = Math.floor(totalHp).toLocaleString();
                document.getElementById('atkDisplay').textContent = Math.floor(totalAtk).toLocaleString();
                document.getElementById('defDisplay').textContent = Math.floor(totalDef).toLocaleString();
                document.getElementById('critDisplay').textContent = critRate.toFixed(1) + '%';

                // è¨ˆç®—æŠ€èƒ½å‚·å®³
                const multipliers = gameData.skillMultipliers[selectedProfession] || 
                                  { basic: 1.0, skill1: 2.5, skill2: 4.0, ultimate: 6.0 };

                ['basic', 'skill1', 'skill2', 'ultimate'].forEach(skill => {
                    const normalDmg = Math.floor(totalAtk * multipliers[skill]);
                    const critDmg = Math.floor(normalDmg * (critDamage / 100));
                    
                    const skillMap = { basic: 'basic', skill1: 'skill1', skill2: 'skill2', ultimate: 'ultimate' };
                    document.getElementById(`${skillMap[skill]}Normal`).textContent = normalDmg.toLocaleString();
                    document.getElementById(`${skillMap[skill]}Crit`).textContent = critDmg.toLocaleString();
                });

                updateStatus(`è¨ˆç®—å®Œæˆ - ${selectedCards.length}å¼µå¡ç‰‡ï¼Œæ”»æ“ŠåŠ›: ${Math.floor(totalAtk).toLocaleString()}`);

            } catch (error) {
                console.error('è¨ˆç®—éŒ¯èª¤:', error);
                updateStatus('è¨ˆç®—ç™¼ç”ŸéŒ¯èª¤');
            }
        }

        function resetDisplay() {
            ['hpDisplay', 'atkDisplay', 'defDisplay'].forEach(id => {
                document.getElementById(id).textContent = '0';
            });
            document.getElementById('critDisplay').textContent = '0%';
            
            ['basicNormal', 'basicCrit', 'skill1Normal', 'skill1Crit', 
             'skill2Normal', 'skill2Crit', 'ultimateNormal', 'ultimateCrit'].forEach(id => {
                document.getElementById(id).textContent = '0';
            });
        }

        // å•Ÿå‹•æ‡‰ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ å•Ÿå‹•ç°¡åŒ–ç‰ˆæˆ°é¬¥è¨ˆç®—å™¨');
            setTimeout(initApp, 100);
        });
    </script>
</body>
</html>
